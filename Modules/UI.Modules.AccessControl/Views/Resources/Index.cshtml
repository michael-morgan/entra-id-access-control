@model IEnumerable<Api.Modules.AccessControl.Persistence.Entities.Authorization.CasbinResource>

@{
    ViewData["Title"] = "Resource Definitions";
}

<h1>Resource Definitions</h1>

<div class="alert alert-info">
    <div class="row align-items-center">
        <div class="col-md-8">
            <p class="mb-2"><strong>Resource Registry:</strong></p>
            <p class="mb-0">
                Define resources with patterns (e.g., "Loan", "Loan/:id", "Document/*") that can be referenced in policies.
                Resources support hierarchical relationships via parent resources and can be workstream-specific or global ("*").
            </p>
        </div>
        <div class="col-md-4 text-end">
            <p class="mb-0 small text-muted">Resources provide metadata and documentation for authorization targets.</p>
        </div>
    </div>
</div>

<p>
    <a asp-action="Create" class="btn btn-primary">Create New Resource</a>
</p>

<form asp-action="Index" method="get" class="row g-3 mb-3">
    <div class="col-md-3">
        <label for="workstreamFilter" class="form-label">Workstream</label>
        <select name="workstreamFilter" id="workstreamFilter" class="form-select">
            <option value="">All Workstreams</option>
            <option value="*" selected="@("*" == ViewBag.WorkstreamFilter)">Global (*)</option>
            <option value="@ViewBag.SelectedWorkstream" selected="@(ViewBag.SelectedWorkstream == ViewBag.WorkstreamFilter)">@ViewBag.SelectedWorkstream</option>
        </select>
    </div>
    <div class="col-md-6">
        <label for="search" class="form-label">Search</label>
        <input type="text" name="search" id="search" class="form-control" value="@ViewBag.Search" placeholder="Search pattern, name, or description..." />
    </div>
    <div class="col-md-3 d-flex align-items-end">
        <button type="submit" class="btn btn-secondary me-2">Filter</button>
        <a asp-action="Index" class="btn btn-outline-secondary">Clear</a>
    </div>
</form>

<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>Workstream</th>
            <th>Resource Pattern</th>
            <th>Display Name</th>
            <th>Description</th>
            <th>Parent</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
@foreach (var item in Model) {
        <tr>
            <td>
                @if (item.WorkstreamId == "*")
                {
                    <span class="badge bg-secondary">Global</span>
                }
                else
                {
                    <span class="badge bg-primary">@item.WorkstreamId</span>
                }
            </td>
            <td><code>@Html.DisplayFor(modelItem => item.ResourcePattern)</code></td>
            <td>@Html.DisplayFor(modelItem => item.DisplayName)</td>
            <td>
                @if (!string.IsNullOrWhiteSpace(item.Description))
                {
                    <span class="text-muted">@item.Description.Substring(0, Math.Min(50, item.Description.Length))@(item.Description.Length > 50 ? "..." : "")</span>
                }
            </td>
            <td>
                @if (!string.IsNullOrWhiteSpace(item.ParentResource))
                {
                    <code>@item.ParentResource</code>
                }
            </td>
            <td>
                <div class="btn-group" role="group">
                    <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-sm btn-info" title="Details">
                        <i class="bi bi-eye"></i>
                    </a>
                    <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-warning" title="Edit">
                        <i class="bi bi-pencil"></i>
                    </a>
                    <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-sm btn-danger" title="Delete">
                        <i class="bi bi-trash"></i>
                    </a>
                </div>
            </td>
        </tr>
}
    </tbody>
</table>

@if (!Model.Any())
{
    <div class="alert alert-info">
        No resources found. <a asp-action="Create">Create your first resource</a>.
    </div>
}
