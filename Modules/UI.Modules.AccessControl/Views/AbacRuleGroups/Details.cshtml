@model Api.Modules.AccessControl.Persistence.Entities.Authorization.AbacRuleGroup

@{
    ViewData["Title"] = "Rule Group Details";
}

<h1>Rule Group Details</h1>

<div>
    <hr />
    <dl class="row">
        <dt class="col-sm-3">Group Name</dt>
        <dd class="col-sm-9">
            <strong>@Html.DisplayFor(model => model.GroupName)</strong>
        </dd>

        <dt class="col-sm-3">Description</dt>
        <dd class="col-sm-9">
            @if (!string.IsNullOrEmpty(Model.Description))
            {
                @Html.DisplayFor(model => model.Description)
            }
            else
            {
                <span class="text-muted">No description</span>
            }
        </dd>

        <dt class="col-sm-3">Workstream</dt>
        <dd class="col-sm-9">
            <span class="badge bg-primary">@Html.DisplayFor(model => model.WorkstreamId)</span>
        </dd>

        <dt class="col-sm-3">Parent Group</dt>
        <dd class="col-sm-9">
            @if (Model.ParentGroup != null)
            {
                <span class="badge bg-secondary">@Model.ParentGroup.GroupName</span>
            }
            else
            {
                <span class="text-muted">Top Level Group</span>
            }
        </dd>

        <dt class="col-sm-3">Logical Operator</dt>
        <dd class="col-sm-9">
            @if (Model.LogicalOperator == "AND")
            {
                <span class="badge bg-info">AND</span>
                <small class="text-muted">All rules/child groups must pass</small>
            }
            else
            {
                <span class="badge bg-warning text-dark">OR</span>
                <small class="text-muted">Any rule/child group can pass</small>
            }
        </dd>

        <dt class="col-sm-3">Resource</dt>
        <dd class="col-sm-9">
            @if (!string.IsNullOrEmpty(Model.Resource))
            {
                <code>@Html.DisplayFor(model => model.Resource)</code>
            }
            else
            {
                <span class="text-muted">Any resource</span>
            }
        </dd>

        <dt class="col-sm-3">Action</dt>
        <dd class="col-sm-9">
            @if (!string.IsNullOrEmpty(Model.Action))
            {
                <code>@Html.DisplayFor(model => model.Action)</code>
            }
            else
            {
                <span class="text-muted">Any action</span>
            }
        </dd>

        <dt class="col-sm-3">Priority</dt>
        <dd class="col-sm-9">
            @Html.DisplayFor(model => model.Priority)
            <small class="text-muted">(Lower numbers evaluated first)</small>
        </dd>

        <dt class="col-sm-3">Status</dt>
        <dd class="col-sm-9">
            @if (Model.IsActive)
            {
                <span class="badge bg-success">Active</span>
            }
            else
            {
                <span class="badge bg-secondary">Inactive</span>
            }
        </dd>

        <dt class="col-sm-3">Created</dt>
        <dd class="col-sm-9">
            @Html.DisplayFor(model => model.CreatedAt)
            @if (!string.IsNullOrEmpty(Model.CreatedBy))
            {
                <small class="text-muted">by @Model.CreatedBy</small>
            }
        </dd>

        @if (Model.ModifiedAt.HasValue)
        {
            <dt class="col-sm-3">Last Modified</dt>
            <dd class="col-sm-9">
                @Html.DisplayFor(model => model.ModifiedAt)
                @if (!string.IsNullOrEmpty(Model.ModifiedBy))
                {
                    <small class="text-muted">by @Model.ModifiedBy</small>
                }
            </dd>
        }
    </dl>

    <hr />

    <h3>Child Groups (@Model.ChildGroups.Count)</h3>
    @if (Model.ChildGroups.Any())
    {
        <table class="table table-sm table-striped">
            <thead>
                <tr>
                    <th>Priority</th>
                    <th>Group Name</th>
                    <th>Operator</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var child in Model.ChildGroups.OrderBy(c => c.Priority))
                {
                    <tr>
                        <td>@child.Priority</td>
                        <td>@child.GroupName</td>
                        <td>
                            @if (child.LogicalOperator == "AND")
                            {
                                <span class="badge bg-info">AND</span>
                            }
                            else
                            {
                                <span class="badge bg-warning text-dark">OR</span>
                            }
                        </td>
                        <td>
                            @if (child.IsActive)
                            {
                                <span class="badge bg-success">Active</span>
                            }
                            else
                            {
                                <span class="badge bg-secondary">Inactive</span>
                            }
                        </td>
                        <td>
                            <a asp-action="Details" asp-route-id="@child.Id" class="btn btn-sm btn-outline-info">View</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <div class="alert alert-info">
            No child groups defined.
        </div>
    }

    <hr />

    <h3>Direct Rules (@Model.Rules.Count)</h3>
    @if (Model.Rules.Any())
    {
        <table class="table table-sm table-striped">
            <thead>
                <tr>
                    <th>Priority</th>
                    <th>Rule Name</th>
                    <th>Type</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var rule in Model.Rules.OrderBy(r => r.Priority))
                {
                    <tr>
                        <td>@rule.Priority</td>
                        <td>@rule.RuleName</td>
                        <td><span class="badge bg-secondary">@rule.RuleType</span></td>
                        <td>
                            @if (rule.IsActive)
                            {
                                <span class="badge bg-success">Active</span>
                            }
                            else
                            {
                                <span class="badge bg-secondary">Inactive</span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <div class="alert alert-info">
            No direct rules defined. Rules can be added through the AbacRules management interface.
        </div>
    }
</div>

<div class="mt-3">
    <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-primary">Edit</a>
    <a asp-action="Index" class="btn btn-secondary">Back to List</a>
</div>
